1) Звернути увагу на дати отримання перших запитів та час взяття в роботу. Чи повпливають вони на загальну статистику?
      165	159660	2020-09-24 07:01:16	2020-10-01 16:00:31	2020-10-01 16:02:02	retail	
      178	160116	2020-09-24 22:32:15	2020-10-01 13:21:42	2020-10-01 13:21:43	retail	
      187	160178	2020-09-25 02:58:13	2020-10-02 11:37:16	2020-10-02 11:41:56	wholesale	
      178	160306	2020-09-25 09:44:12	2020-10-02 07:23:09	2020-10-02 07:25:33	retail	
      178	163042	2020-09-30 15:56:08	2020-10-02 07:37:33	2020-10-02 07:47:57	retail	


2)    Черновий аналіз даних
      
      
            
            -- Кількість унікальних модераторів (49)
            
            
            select 
            	count(distinct moderator) 
            from public.events 
            
            -- Кількість запитів (35 617)
            
            
            select 
            	count( id_request) 
            from public.events 
            
            -- Перша дата запиту (2020-09-24 07:01:16)
            
            
            select 
            	min(request_time)
            from public.events
            
            -- Остання дата запиту (2020-12-31 22:11:17)
            
            
            select 
            	max(request_time)
            from public.events
            
            -- Кількість запитів по командам (retail= 14025; wholesale= 21592 )
            
            
            select 
            	count(team)
            from public.events
            where team = 'wholesale'
            
            
            -- Середній час обробки запиту (00:02:14)
            
            select 
            	avg(finish_time - start_time) as avg_request_time
            from public.events
            
            
            -- Середній час обробки запиту для retail (00:01:58)
            
            select 
            	avg(finish_time - start_time) as avg_request_time_retail
            from public.events
            where team = 'retail'
            
            
            -- Середній час обробки запиту для wholesale (00:02:24)
            
            select 
            	avg(finish_time - start_time) as avg_request_time_wholesale
            from public.events
            where team = 'wholesale'


            -- TOP запитів по модераторам 

            select 
            	count(id_request) as total_requests_by_moderators,
            	moderator
            from public.events
            group by moderator 
            order by total_requests_by_moderators 
            -- Модератор № 188 виконав 3746 запитів, інші від 1717 і менше
            -- Шість операторів виконали 2 запита або менше (ймовірно допомога старших модераторів або керівництва)
            
            
            -- AVG к-ть запитів для retail модератора (584)
            
            select 	
            	round(avg(total_requests_by_retail.count_requests), 0) as avg_requests_retail
            from (	select
            			count(id_request) as count_requests,
            			moderator
            		from public.events
            		where team = 'retail'
            		group by moderator 
            	 ) as total_requests_by_retail
            	 
            	 
            -- AVG к-ть запитів для wholesale модератора (864)
            
            select 	
            	round(avg(total_requests_by_wholesale.count_requests), 0) as avg_requests_wholesale
            from (	select
            			count(id_request) as count_requests,
            			moderator
            		from public.events
            		where team = 'wholesale'
            		group by moderator 
            	 ) as total_requests_by_wholesale
            
            
            -- AVG час виконання запиту для ТОП 10 модераторів retail
            
            select 
            	date_trunc('second', avg(e.finish_time - e.start_time)) as avg_time_request_retail,
            	t.moderator
            from public.events as e
            join	(	select
            				count(id_request) as count_requests,
            				moderator 
            			from public.events
            			where team = 'retail'
            			group by moderator 
            			order by count_requests desc
            			limit 10
            		)as t ON e.moderator = t.moderator
            where e.team = 'retail'
            group by t.moderator 
            order by avg_time_request_retail desc
            
            
            -- AVG час виконання запиту для ТОП 10 модераторів wholesale
            
            select 
            	date_trunc('second', avg(e.finish_time - e.start_time)) as avg_time_request_wholesale,
            	t.moderator
            from public.events as e
            join	(	select
            				count(id_request) as count_requests,
            				moderator 
            			from public.events
            			where team = 'wholesale'
            			group by moderator 
            			order by count_requests desc
            			limit 10
            		)as t ON e.moderator = t.moderator
            where e.team = 'wholesale'
            group by t.moderator 
            order by avg_time_request_wholesale desc


            -- Знаходимо розклад роботи модераторів та к-ть модераторів на зміні
            
            with work_time as 
            	(
            	select 
            		moderator,
            		team,
            		start_time::date as work_day,
            		to_char(MIN(start_time), 'HH24:MI:SS') as start_work,
            		to_char(MAX(start_time), 'HH24:MI:SS')  as end_work
            	from public.events
            	group by
            		moderator,
            		start_time::date,
            		team
            	)
            	
            select 
            	work_day,
            	count(moderator) as total_moderator_on_shift,
            	count(case when team = 'retail' then 1 end) as retail_moderator,  		--к-ть модераторів на зміні retail
            	count(case when team = 'wholesale' then 1 end) as wholesale_moderator   --к-ть модераторів на зміні wholesale
            from work_time
            group by 
            	work_day
            order by 
            	work_day 

            
